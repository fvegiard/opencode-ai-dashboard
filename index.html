<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>fvegiard ¬∑ AI System Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
<style>
  :root {
    --bg: #0d1117;
    --bg2: #161b22;
    --bg3: #21262d;
    --border: #30363d;
    --text: #e6edf3;
    --text2: #8b949e;
    --accent: #58a6ff;
    --green: #3fb950;
    --yellow: #d29922;
    --red: #f85149;
    --purple: #bc8cff;
    --orange: #ffa657;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--bg); color: var(--text); font-family: -apple-system, 'Segoe UI', sans-serif; line-height: 1.6; }

  header {
    background: var(--bg2);
    border-bottom: 1px solid var(--border);
    padding: 16px 32px;
    display: flex;
    align-items: center;
    gap: 16px;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  header h1 { font-size: 1.1rem; font-weight: 600; color: var(--text); }
  header .badge { background: var(--green); color: #000; font-size: 0.7rem; font-weight: 700; padding: 2px 8px; border-radius: 20px; }
  header .sub { color: var(--text2); font-size: 0.85rem; margin-left: auto; }
  .dot { width: 8px; height: 8px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

  main { max-width: 1400px; margin: 0 auto; padding: 32px; }

  .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 28px; }
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 28px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 28px; }

  .card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    transition: border-color .2s;
  }
  .card:hover { border-color: var(--accent); }
  .card h2 { font-size: 0.8rem; font-weight: 600; color: var(--text2); text-transform: uppercase; letter-spacing: .05em; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
  .card h2 .icon { font-size: 1rem; }

  .stat { font-size: 2rem; font-weight: 700; color: var(--text); }
  .stat-label { font-size: 0.8rem; color: var(--text2); margin-top: 4px; }

  .status-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 0.85rem; }
  .status-row:last-child { border-bottom: none; }
  .status-ok { color: var(--green); font-weight: 600; }
  .status-warn { color: var(--yellow); font-weight: 600; }
  .status-err { color: var(--red); font-weight: 600; }

  .pill { display: inline-block; padding: 2px 10px; border-radius: 20px; font-size: 0.72rem; font-weight: 600; }
  .pill-green { background: rgba(63,185,80,.15); color: var(--green); border: 1px solid rgba(63,185,80,.3); }
  .pill-blue { background: rgba(88,166,255,.15); color: var(--accent); border: 1px solid rgba(88,166,255,.3); }
  .pill-purple { background: rgba(188,140,255,.15); color: var(--purple); border: 1px solid rgba(188,140,255,.3); }
  .pill-orange { background: rgba(255,166,87,.15); color: var(--orange); border: 1px solid rgba(255,166,87,.3); }

  .mermaid-wrap {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 28px;
    overflow-x: auto;
  }
  .mermaid-wrap h2 { font-size: 0.8rem; font-weight: 600; color: var(--text2); text-transform: uppercase; letter-spacing: .05em; margin-bottom: 20px; }
  .mermaid { display: flex; justify-content: center; }

  .model-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 0.84rem; }
  .model-row:last-child { border-bottom: none; }
  .model-name { font-family: 'SF Mono', monospace; color: var(--text); }
  .model-provider { color: var(--text2); font-size: 0.75rem; }

  .task-item { display: flex; gap: 10px; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 0.84rem; }
  .task-item:last-child { border-bottom: none; }
  .task-done { color: var(--green); }
  .task-pending { color: var(--yellow); }

  .table-stats { display: flex; gap: 12px; flex-wrap: wrap; }
  .table-stat { background: var(--bg3); border: 1px solid var(--border); border-radius: 8px; padding: 12px 16px; text-align: center; flex: 1; min-width: 100px; }
  .table-stat .n { font-size: 1.5rem; font-weight: 700; color: var(--accent); }
  .table-stat .lbl { font-size: 0.72rem; color: var(--text2); margin-top: 2px; }

  footer { border-top: 1px solid var(--border); padding: 20px 32px; text-align: center; color: var(--text2); font-size: 0.8rem; }
  .refresh { color: var(--text2); font-size: 0.75rem; }

  #live-badge { transition: all .3s; }
</style>
</head>
<body>

<header>
  <div class="dot"></div>
  <h1>fvegiard ¬∑ AI System Dashboard</h1>
  <span class="badge">LIVE</span>
  <span class="sub" id="last-updated">Chargement...</span>
</header>

<main>

  <!-- KPI row -->
  <div class="grid" id="kpi-row">
    <div class="card">
      <h2><span class="icon">ü§ñ</span> Mod√®les disponibles</h2>
      <div class="stat" id="stat-models">9</div>
      <div class="stat-label">providers: Anthropic ¬∑ Google ¬∑ OpenAI ¬∑ Ollama</div>
    </div>
    <div class="card">
      <h2><span class="icon">üß†</span> M√©moire persist√©e</h2>
      <div class="stat" id="stat-memory">16</div>
      <div class="stat-label">cl√©s ¬∑ configs ¬∑ sessions ¬∑ agents</div>
    </div>
    <div class="card">
      <h2><span class="icon">‚ö°</span> GPU</h2>
      <div class="stat" style="color:var(--green)">38¬∞C</div>
      <div class="stat-label">RTX 5090 24GB ¬∑ mode hybrid ¬∑ 0% util</div>
    </div>
    <div class="card">
      <h2><span class="icon">üí¨</span> WhatsApp</h2>
      <div class="stat" style="color:var(--green)">‚úì</div>
      <div class="stat-label">openclaw-gateway ¬∑ reconnect√©</div>
    </div>
  </div>

  <!-- Architecture diagram -->
  <div class="mermaid-wrap">
    <h2>üèóÔ∏è Architecture Syst√®me</h2>
    <div class="mermaid">
graph TB
    User["üë§ fvegiard"] -->|"messages"| WA["üì± WhatsApp\nGateway"]
    User -->|"terminal"| OC["üíª OpenCode\n(Claude Code)"]
    User -->|"chat"| OCL["ü¶Ö OpenClaw\n(main + coding)"]

    WA --> OCL
    OC -->|"orchestration"| SIS["ü™® Sisyphus\nOrchestrator"]
    OCL -->|"orchestration"| SIS

    SIS --> ORA["üîÆ Oracle\nHigh-IQ Consultant"]
    SIS --> EXP["üîç Explore\nCodebase Search"]
    SIS --> LIB["üìö Librarian\nDocs & Web"]
    SIS --> PRO["‚ö° Prometheus\nPlanner"]
    SIS --> MET["üß≠ Metis\nPre-analysis"]
    SIS --> MOM["‚öñÔ∏è Momus\nReviewer"]

    ORA -->|"antigravity"| AG["‚òÅÔ∏è Google Antigravity\nClaude Opus 4.6 thinking"]
    EXP -->|"antigravity"| AGF["‚òÅÔ∏è Gemini 3 Flash"]
    LIB -->|"antigravity"| AGF
    PRO -->|"antigravity"| AGP["‚òÅÔ∏è Gemini 3.1 Pro"]
    MET -->|"antigravity"| AGP
    MOM -->|"antigravity"| AGP

    SIS -->|"memory"| SUP["üóÑÔ∏è Supabase\niawsshgkogntmdzrfjyw"]
    SUP --> MEM["memory\n16 rows"]
    SUP --> CFG["configs\n6 rows"]
    SUP --> INV["agent_inventory\n9 rows"]
    SUP --> SES["sessions\n1 row"]

    OCL -->|"embedding"| OLL["üñ•Ô∏è Ollama Local\nqwen3-embedding:8b\nRTX 5090 24GB"]

    style User fill:#1f6feb,color:#fff
    style SIS fill:#3d1f6f,color:#fff
    style SUP fill:#1a7f4f,color:#fff
    style AG fill:#d29922,color:#000
    style AGF fill:#d29922,color:#000
    style AGP fill:#d29922,color:#000
    style OLL fill:#0d419d,color:#fff
    </div>
  </div>

  <!-- Agent routing + model matrix -->
  <div class="grid-2">
    <div class="mermaid-wrap" style="margin-bottom:0">
      <h2>üîÄ Agent Routing</h2>
      <div class="mermaid">
flowchart LR
    T["Task"] --> C{"Category"}
    C -->|"visual-engineering"| S["claude-sonnet-4-6"]
    C -->|"ultrabrain/artistry"| O["claude-opus-4-6\nüß† thinking max"]
    C -->|"deep/writing/unspecified-high"| G31["gemini-3.1-pro\nhigh"]
    C -->|"quick/unspecified-low"| GF["gemini-3-flash\nlow"]

    style O fill:#6e40c9,color:#fff
    style S fill:#1a7f4f,color:#fff
    style G31 fill:#d29922,color:#000
    style GF fill:#0d419d,color:#fff
      </div>
    </div>

    <div class="mermaid-wrap" style="margin-bottom:0">
      <h2>üíæ Memory Flow</h2>
      <div class="mermaid">
sequenceDiagram
    participant S as Session Start
    participant CL as context-loader.mjs
    participant SB as Supabase REST
    participant A as AI Agent

    S->>CL: node ~/context-loader.mjs
    CL->>SB: GET /memory?select=*
    CL->>SB: GET /agent_inventory
    CL->>SB: GET /sessions?limit=1
    SB-->>CL: 16 keys + 9 agents + last session
    CL-->>A: Compact markdown context
    A->>SB: POST /sessions (save work)
    A->>SB: UPSERT /memory (new facts)
      </div>
    </div>
  </div>

  <!-- System status -->
  <div class="grid-2" style="margin-top:28px">
    <div class="card">
      <h2><span class="icon">üñ•Ô∏è</span> √âtat Syst√®me</h2>
      <div class="status-row"><span>GPU RTX 5090</span><span class="status-ok">38¬∞C ¬∑ hybrid ‚úì</span></div>
      <div class="status-row"><span>WhatsApp Gateway</span><span class="status-ok">connect√© ‚úì</span></div>
      <div class="status-row"><span>Supabase (new)</span><span class="status-ok">iawsshgkogntmdzrfjyw ‚úì</span></div>
      <div class="status-row"><span>Ollama (local)</span><span class="status-ok">qwen3-embedding:8b ‚úì</span></div>
      <div class="status-row"><span>HDMI (TV)</span><span class="status-warn">‚ö† logout/login COSMIC requis</span></div>
      <div class="status-row"><span>opencode-serve.service</span><span class="status-err">crash loop ‚Äî √† fix</span></div>
      <div class="status-row"><span>Anciens logs (432MB)</span><span class="status-warn">‚ö† √† nettoyer</span></div>
    </div>

    <div class="card">
      <h2><span class="icon">üóÑÔ∏è</span> Supabase Tables</h2>
      <div class="table-stats" id="supabase-stats">
        <div class="table-stat"><div class="n">16</div><div class="lbl">memory</div></div>
        <div class="table-stat"><div class="n">6</div><div class="lbl">configs</div></div>
        <div class="table-stat"><div class="n">9</div><div class="lbl">agents</div></div>
        <div class="table-stat"><div class="n">1</div><div class="lbl">sessions</div></div>
        <div class="table-stat"><div class="n">0</div><div class="lbl">chat_history</div></div>
      </div>
    </div>
  </div>

  <!-- Models inventory (live from Supabase) -->
  <div class="card" style="margin-top:28px">
    <h2><span class="icon">ü§ñ</span> Inventaire Mod√®les AI ‚Äî <span style="color:var(--green);text-transform:none;font-weight:400" id="model-status">chargement live...</span></h2>
    <div id="model-list">
      <!-- Populated by JS -->
    </div>
  </div>

  <!-- Pending tasks -->
  <div class="card" style="margin-top:28px">
    <h2><span class="icon">üìã</span> T√¢ches ‚Äî session courante</h2>
    <div class="task-item"><span class="task-done">‚úÖ</span><span>System audit: GPU, CPU, WhatsApp, logs fixes</span></div>
    <div class="task-item"><span class="task-done">‚úÖ</span><span>Fan noise: vectorize_emails.py killed, GPU 38¬∞C</span></div>
    <div class="task-item"><span class="task-done">‚úÖ</span><span>WhatsApp: gateway restart + reconnexion v√©rifi√©e</span></div>
    <div class="task-item"><span class="task-done">‚úÖ</span><span>HDMI: mode hybrid activ√© (COSMIC logout/login requis)</span></div>
    <div class="task-item"><span class="task-done">‚úÖ</span><span>Research: best AI models 2026, architecture, local RTX 5090</span></div>
    <div class="task-item"><span class="task-done">‚úÖ</span><span>Supabase: nouveau projet + 5 tables cr√©√©es via Management API</span></div>
    <div class="task-item"><span class="task-done">‚úÖ</span><span>Dump complet m√©moire ‚Üí Supabase (16 keys, 6 configs, 9 agents)</span></div>
    <div class="task-item"><span class="task-done">‚úÖ</span><span>context-loader.mjs ‚Äî √©conomie tokens √† chaque session</span></div>
    <div class="task-item"><span class="task-done">‚úÖ</span><span>Dashboard Netlify avec Mermaid</span></div>
    <div class="task-item"><span class="task-pending">‚è≥</span><span>HDMI: logout/login COSMIC (action user)</span></div>
    <div class="task-item"><span class="task-pending">‚è≥</span><span>5 agents OpenClaw (plan propos√©, pas encore valid√©)</span></div>
    <div class="task-item"><span class="task-pending">‚è≥</span><span>Fix opencode-serve.service crash loop</span></div>
    <div class="task-item"><span class="task-pending">‚è≥</span><span>Nettoyer 432MB anciens logs</span></div>
  </div>

</main>

<footer>
  <div>fvegiard AI System ¬∑ Supabase <code>iawsshgkogntmdzrfjyw</code> ¬∑ Pop!_OS ¬∑ RTX 5090</div>
  <div class="refresh" style="margin-top:6px">Donn√©es live depuis Supabase ¬∑ <span id="refresh-time"></span></div>
</footer>

<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark',
    themeVariables: {
      background: '#161b22',
      primaryColor: '#1f6feb',
      primaryTextColor: '#e6edf3',
      primaryBorderColor: '#30363d',
      lineColor: '#58a6ff',
      secondaryColor: '#21262d',
      tertiaryColor: '#21262d',
      edgeLabelBackground: '#161b22',
      fontSize: '14px'
    }
  });

  const SUPA = 'https://iawsshgkogntmdzrfjyw.supabase.co';
  const ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlhd3NzaGdrb2dudG1kenJmanl3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2NDkwMDUsImV4cCI6MjA4MzIyNTAwNX0.1BxhI5SWLL5786qsshidOMpTsOrGeNob6xpcKQjI4s4';
  const H = { 'apikey': ANON, 'Authorization': `Bearer ${ANON}` };

  const catColor = { reasoning: 'pill-purple', coding: 'pill-green', fast: 'pill-blue', embedding: 'pill-orange' };

  async function loadLiveData() {
    try {
      const [agents, memory] = await Promise.all([
        fetch(`${SUPA}/rest/v1/agent_inventory?select=name,provider,category,notes&is_active=eq.true&order=provider.asc`, { headers: H }).then(r => r.json()),
        fetch(`${SUPA}/rest/v1/memory?select=count`, { headers: H }).then(r => r.json()),
      ]);

      // Render model list
      const ml = document.getElementById('model-list');
      ml.innerHTML = agents.map(a => `
        <div class="model-row">
          <div>
            <div class="model-name">${a.name}</div>
            <div class="model-provider">${a.provider}</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <span class="pill ${catColor[a.category] || 'pill-blue'}">${a.category}</span>
          </div>
        </div>
      `).join('');

      document.getElementById('model-status').textContent = `${agents.length} mod√®les actifs ¬∑ live ‚úì`;
      document.getElementById('stat-models').textContent = agents.length;
      document.getElementById('last-updated').textContent = 'Live ¬∑ ' + new Date().toLocaleTimeString('fr-CA');
      document.getElementById('refresh-time').textContent = new Date().toLocaleString('fr-CA');
    } catch(e) {
      document.getElementById('model-status').textContent = 'erreur chargement';
    }
  }

  loadLiveData();
  setInterval(loadLiveData, 30000);
</script>

</body>
</html>
